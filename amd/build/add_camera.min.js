define ("quizaccess_proctoring/add_camera",["jquery","core/str","core/modal_factory"],function(a,b,c){var d=function(b){var c=1<arguments.length&&arguments[1]!==void 0?arguments[1]:!1,d=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null,e=a(document);this.video=document.getElementById(this.videoid);this.canvas=document.getElementById(this.canvasid);this.cmid=b;this.mainimage=c;this.attemptid=d;e.on("popup",this.showpopup.bind(this));setTimeout(navigator.mediaDevices.getUserMedia({video:!0,audio:!1}).then(function(a){if(this.video){this.video.srcObject=a;this.video.play()}}).catch(function(){}),1e4)};d.prototype.video=!1;d.prototype.videoid="video";d.prototype.canvas=!1;d.prototype.canvasid="canvas";d.prototype.width=320;d.prototype.height=240;d.prototype.takepictureid="takepicture";d.prototype.retakeid="retake";d.prototype.cmid=!1;d.prototype.mainimage=!1;d.prototype.attemptid=!1;d.prototype.takepicture=function(){var c=this.canvas.getContext("2d");c.drawImage(this.video,0,0,this.width,this.height);var d=this.canvas.toDataURL("image/png");a("#"+this.videoid).hide();a("#"+this.takepictureid).hide();a("#"+this.canvasid).show();a("#"+this.retakeid).show();a("input[name='userimg']").val(d);a.ajax({url:M.cfg.wwwroot+"/mod/quiz/accessrule/proctoring/ajax.php",method:"POST",data:{imgBase64:d,cmid:this.cmid,attemptid:this.attemptid,mainimage:this.mainimage},success:function success(c){if(c&&c.errorcode){a(document).trigger("popup",b.get_string(c.errorcode,"quizaccess_proctoring"))}}})};d.prototype.proctoringimage=function(){var c=this.canvas.getContext("2d");c.drawImage(this.video,0,0,this.width,this.height);var d=this.canvas.toDataURL("image/png");a.ajax({url:M.cfg.wwwroot+"/mod/quiz/accessrule/proctoring/ajax.php",method:"POST",data:{imgBase64:d,cmid:this.cmid,attemptid:this.attemptid,mainimage:this.mainimage},success:function success(c){if(c&&c.errorcode){a(document).trigger("popup",b.get_string(c.errorcode,"quizaccess_proctoring"))}}})};d.prototype.retake=function(){a("#"+this.videoid).show(this.cmid);a("#"+this.takepictureid).show();a("#"+this.canvasid).hide();a("#"+this.retakeid).hide()};d.prototype.showpopup=function(a,b){c.create({body:b}).then(function(a){a.show()})};return{init:function init(b,c){var e=2<arguments.length&&arguments[2]!==void 0?arguments[2]:!1,f=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null,g=4<arguments.length&&arguments[4]!==void 0?arguments[4]:5;if(e){a("<canvas>").attr({id:"canvas",style:"display: none;"}).appendTo("body");a("<video>").attr({id:"video",width:"320",height:"240",autoplay:"autoplay"}).appendTo("body");var h=new d(b,c,f);setInterval(h.proctoringimage.bind(h),1e3*(60*g))}else{var h=new d(b,c,f);a("#"+h.takepictureid).on("click",function(a){a.preventDefault();h.takepicture()});a("#"+h.retakeid).on("click",function(a){a.preventDefault();h.retake()})}}}});
//# sourceMappingURL=add_camera.min.js.map
